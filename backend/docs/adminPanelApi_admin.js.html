<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: adminPanelApi/admin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: adminPanelApi/admin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'
const User = require("../orm/user")
const Permission = require("../orm/permission")
const Region = require("../orm/region")

/** @module model/adminPanelApi/admin */

async function editUser(userId, email, password, region_id) {
    email = (typeof (email) == "string") ? email.trim() : undefined
    if (password === "") {
        password = undefined
    }
    if (!(+userId)) throw "userId must be not empty"

    return User
        .query()
        .findById(userId)
        .first()
        .patch({ email, password, region_id })
        .then(res => {
            if (res) {
                return User.getUserById(userId)
            } else {
                throw "fail"
            }
        })
}

/**
 * Добавляет нового пользователя
 * @param {string} email Все пробелы вначале и конце будут стерты
 * JSON Scheme формат email, другой формат не пройдет валидацию
 * @param {string} password пароль не короче 8 символов максимальная длина 72
 * @param {number} permission_id id назначаемых пользователю прав
 * @param {number} region_id id назначаемого пользователю региона
 * @return {} см. User.getUserById
 * @see {@link module:model/orm/user~User.getUserById}
 */
async function addUser(email, password, permission_id, region_id) {
    //проверки входных данных
    if (!permission_id || !Number.isInteger(+permission_id)) {
        throw "permission_id must be integer"
    }

    if (!region_id || !Number.isInteger(+region_id)) {
        throw "region_id must be integer"
    }

    if (typeof (email) === "string") {
        //удаляем пробелы пробелы из email
        email = email.trim()
    } else {
        throw "email must not be empty"
    }

    if (!await Permission.hasPermission()) {
        throw "permission with this id not found"
    }

    if (await User.hasEmail(email)) {
        throw "this user already exists"
    }
    //добавление пользователя
    const userId = await User.query().insert({ email, password, permission_id, region_id }).then(res => res.id)
    return await User.getUserById(userId)
}

/**
 * Возвращает данные всех пользователей
 * @return {} см. User.getUserById
 * @see {@link module:model/orm/user~User.getUserById}
 */
async function getUsers() {
    return User.getUserById()
}

/**
 * Добавляет регион в таблицу
 * @param {string} region Имя добавляемого региона
 * @return {} ответ вида [{"id": 1, "region": "адыгея"}]
 * @see {@link module:model/orm/region~Region.getRegionById} формат вывода.
 * @throws {"incorrect region"} region либо пустое либо не является строкой
 */
async function addRegion(region) {
    if (!region || typeof (region) != "string") {
        throw "incorrect region"
    }
    return [await Region.query().insert({ region })]
}

/**
 * Возвращает данные всех регионов из базы данных
 * @return {} ответ вида [{"id": 1, "region": "адыгея"}]
 * @see {@link module:model/orm/region~Region.getRegionById} формат вывода.
 */
async function getRegions() {
    return Region.getRegionById()
}

/**
 * Редактирование региона
 * @param {number} regionId id региона который будем редактировать
 * @param {string} region новое имя региона
 * @return {} ответ вида [{"id": 1, "region": "адыгея"}]
 * @see {@link module:model/orm/region~Region.getRegionById} формат вывода.
 * @throws {"incorrect regionId"} параметр regionId не integer
 * @throws {"incorrect region"} параметр region не string
 * @throws {"fail"} не удалось добавить в базу, вероятно нет такого regionId
 */
async function editRegion(regionId, region) {
    if (!Number.isInteger(+regionId)) {
        throw "incorrect regionId"
    }
    if (typeof (region) != "string") {
        throw "incorrect region"
    }

    const getRegion = await Region.query().findById(regionId).patch({ region })
    if (getRegion) {
        return await Region.getRegionById(regionId)
    } else {
        throw "fail"
    }
}

/**
 * Возвращает данные всех прав из базы данных
 * @return {} ответ вида [{"id": 1, "permission": "admin"}]
 * @see AAA
 */
function getPermission() {
    return Permission.query()
}

function delUser(id) {
    User.query().delete().where("email", email)
}

exports.editRegion = editRegion
exports.getRegions = getRegions
exports.addRegion = addRegion
exports.editUser = editUser
exports.addUser = addUser
exports.getUsers = getUsers
exports.getPermission = getPermission</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-model_adminPanelApi_admin.html">model/adminPanelApi/admin</a></li><li><a href="module-model_orm_moder_status.html">model/orm/moder_status</a></li><li><a href="module-model_orm_permission.html">model/orm/permission</a></li><li><a href="module-model_orm_region.html">model/orm/region</a></li><li><a href="module-model_orm_user.html">model/orm/user</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-model_orm_moder_status-Moder_status.html">Moder_status</a></li><li><a href="module-model_orm_permission-Permission.html">Permission</a></li><li><a href="module-model_orm_region-Region.html">Region</a></li><li><a href="module-model_orm_user-User.html">User</a></li></ul><h3>Global</h3><ul><li><a href="global.html#editPoint">editPoint</a></li><li><a href="global.html#editPointModer">editPointModer</a></li><li><a href="global.html#getPointsModer">getPointsModer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Thu Sep 17 2020 09:59:48 GMT+0300 (GMT+03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
